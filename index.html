<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ–°æ˜¥å°è»Šç¥ - æ”¤ä½éŠæˆ²è¨ˆåˆ†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: radial-gradient(circle, #b91c1c 0%, #7f1d1d 100%);
            color: #fef3c7;
            /* é–å®šè¢å¹•é«˜åº¦èˆ‡å¯¬åº¦ï¼Œé˜²æ­¢ iPad æ»‘å‹• */
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            margin: 0;
            touch-action: manipulation;
        }

        .lantern {
            position: absolute;
            width: 50px; /* ç¨å¾®ç¸®å°ç‡ˆç±  */
            height: 65px;
            background: #dc2626;
            border-radius: 15px;
            border: 3px solid #facc15;
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.4);
            animation: swing 3s ease-in-out infinite alternate;
            z-index: 5;
        }
        .lantern::after {
            content: "ç¦";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #facc15;
            font-weight: bold;
            font-size: 20px;
        }

        .horse-deco {
            position: absolute;
            opacity: 0.15;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes swing {
            from { transform: rotate(-8deg); }
            to { transform: rotate(8deg); }
        }

        .score-card {
            background: rgba(0, 0, 0, 0.5);
            border: 4px solid #facc15;
            border-radius: 2rem;
            transition: transform 0.1s;
            cursor: pointer;
            user-select: none;
            position: relative;
            overflow: hidden;
            /* è®“å¡ç‰‡å…§å®¹å‚ç›´ç½®ä¸­ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-card:active {
            transform: scale(0.96);
        }

        .timer-display {
            font-family: 'Courier New', Courier, monospace;
            text-shadow: 0 0 30px #facc15, 0 0 10px #ffffff;
        }

        .title-glow {
            text-shadow: 0 0 15px rgba(250, 204, 21, 0.8);
            background: linear-gradient(to bottom, #fde047, #ca8a04);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .rule-badge {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #facc15;
            border-radius: 1rem;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <!-- è£é£¾èƒŒæ™¯ -->
    <div class="horse-deco top-6 left-6">
        <svg width="200" height="200" viewBox="0 0 24 24" fill="#facc15"><path d="M19,20H17L15.68,14.72L14.36,12H10V10H14V8H11V6H13V4H7V6H9V8H6L3.41,10.59L3,11V15H5V11.41L6.41,10H8V12H5V14H8V20H6L5.32,14.72L4,12H2V20H0V22H24V20H19Z"/></svg>
    </div>
    <div class="horse-deco bottom-6 right-6 scale-x-[-1]">
        <svg width="200" height="200" viewBox="0 0 24 24" fill="#facc15"><path d="M19,20H17L15.68,14.72L14.36,12H10V10H14V8H11V6H13V4H7V6H9V8H6L3.41,10.59L3,11V15H5V11.41L6.41,10H8V12H5V14H8V20H6L5.32,14.72L4,12H2V20H0V22H24V20H19Z"/></svg>
    </div>

    <div class="lantern" style="top: 15px; left: 8%;"></div>
    <div class="lantern" style="top: 15px; right: 8%;"></div>

    <!-- ä½¿ç”¨ h-full å’Œ flex ç¢ºä¿å…§å®¹å‚ç›´ç½®ä¸­ -->
    <div id="app" class="relative z-10 flex flex-col items-center justify-center h-full w-full p-4 box-border">
        
        <!-- é é¢ 1: éŠæˆ²ç°¡ä»‹èˆ‡æ§åˆ¶èªªæ˜ -->
        <div id="intro-screen" class="text-center w-full max-w-[95%] h-[90%] flex flex-col">
            <h1 class="text-5xl md:text-6xl font-black mb-4 title-glow flex-none">ğŸï¸ æ–°æ˜¥å°è»Šç¥ ğŸï¸</h1>
            
            <div class="bg-red-900/80 p-6 rounded-[2rem] border-4 border-yellow-500 shadow-2xl backdrop-blur-md flex-1 flex flex-col justify-between overflow-hidden">
                <!-- å…§å®¹å€åŸŸï¼šè‡ªå‹•ä¼¸ç¸® -->
                <div class="flex flex-col lg:flex-row gap-6 items-stretch flex-1 min-h-0">
                    
                    <!-- å·¦å´ï¼šæ“æ§èªªæ˜åœ– (ä½” 2/3) -->
                    <div class="lg:w-2/3 flex flex-col items-center justify-center w-full bg-black/20 rounded-xl p-2">
                        <h2 class="text-2xl font-bold mb-2 text-yellow-100 flex items-center gap-2 flex-none">
                            <span>ğŸ®</span> é™æ§æ“ä½œæ•™å­¸
                        </h2>
                        <div class="flex-1 w-full flex items-center justify-center overflow-hidden">
                            <!-- åœ–ç‰‡è¨­å®š object-contain ä¸¦é™åˆ¶é«˜åº¦ï¼Œç¢ºä¿ä¸æ’é–‹ç‰ˆé¢ -->
                            <img src="controller.png" alt="[é™æ§æ“ä½œæ•™å­¸]" class="max-w-full max-h-full object-contain">
                        </div>
                        <p class="mt-2 text-lg text-yellow-200 font-medium italic flex-none">ç†Ÿæ‚‰æŒ‰éµï¼Œæº–å‚™é–‹è·‘ï¼</p>
                    </div>

                    <!-- å³å´ï¼šè¨ˆåˆ†è¦å‰‡ (ä½” 1/3) -->
                    <div class="lg:w-1/3 flex flex-col w-full h-full">
                        <h2 class="text-2xl font-bold mb-2 text-yellow-100 flex items-center gap-2 flex-none">
                            <span>ğŸ§§</span> è¨ˆåˆ†è¦å‰‡
                        </h2>
                        <div class="flex flex-col gap-3 h-full justify-center flex-1">
                            <div class="rule-badge p-3 flex items-center gap-4 bg-red-800/40 flex-1">
                                <span class="text-4xl">ğŸ§§</span>
                                <div class="text-left">
                                    <p class="text-base font-bold text-yellow-100">æ–°æ˜¥è£é£¾</p>
                                    <p class="text-2xl font-black text-yellow-400">+1 <span class="text-sm">åˆ†</span></p>
                                </div>
                            </div>
                            <div class="rule-badge p-3 flex items-center gap-4 border-4 border-yellow-400 bg-yellow-400/20 shadow-lg flex-1">
                                <span class="text-4xl">ğŸ</span>
                                <div class="text-left">
                                    <p class="text-base font-bold text-yellow-500">é¦¬å¹´ç”Ÿè‚–</p>
                                    <p class="text-2xl font-black text-yellow-400">+3 <span class="text-sm">åˆ†</span></p>
                                </div>
                            </div>
                            <div class="rule-badge p-3 flex items-center gap-4 bg-red-800/40 flex-1">
                                <span class="text-4xl">ğŸ²</span>
                                <div class="text-left">
                                    <p class="text-base font-bold text-yellow-100">å…¶ä»–ç”Ÿè‚–</p>
                                    <p class="text-2xl font-black text-yellow-400">+1 <span class="text-sm">åˆ†</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button onclick="showSetup()" 
                    class="mt-4 block w-full bg-gradient-to-r from-yellow-600 to-yellow-400 text-red-950 text-3xl font-black py-4 rounded-2xl transition-all transform hover:scale-[1.02] active:scale-95 shadow-xl border-b-4 border-yellow-800 flex-none">
                    ä¸‹ä¸€æ­¥ (è¨­å®šæ™‚é–“) â”
                </button>
            </div>
        </div>

        <!-- é é¢ 2: åˆå§‹è¨­å®šé é¢ -->
        <div id="setup-screen" class="hidden text-center w-full max-w-2xl">
            <h1 class="text-6xl font-black mb-6 title-glow">ğŸï¸ æ–°æ˜¥å°è»Šç¥ ğŸï¸</h1>
            <div class="bg-red-900/80 p-8 rounded-[2rem] border-4 border-yellow-500 shadow-2xl backdrop-blur-md">
                <label class="block text-3xl mb-6 text-yellow-100 font-bold">æ¯”è³½æ™‚é–“è¨­å®š (ç§’)</label>
                <div class="flex items-center justify-center gap-6 mb-8">
                    <button onclick="adjustTime(-10)" class="text-4xl bg-red-700 w-24 h-20 rounded-2xl border-4 border-yellow-500 shadow-lg active:scale-95 transition-all font-black flex items-center justify-center">-10</button>
                    <input type="number" id="time-input" value="60" min="10" max="999" 
                        class="text-6xl p-4 rounded-2xl text-red-900 w-48 text-center font-black focus:outline-none border-4 border-yellow-400 bg-yellow-50 shadow-inner">
                    <button onclick="adjustTime(10)" class="text-4xl bg-red-700 w-24 h-20 rounded-2xl border-4 border-yellow-500 shadow-lg active:scale-95 transition-all font-black flex items-center justify-center">+10</button>
                </div>
                <button onclick="startGame()" 
                    class="bg-gradient-to-r from-yellow-600 to-yellow-400 text-red-950 text-4xl font-black py-5 rounded-2xl transition-all transform hover:scale-[1.02] active:scale-95 shadow-2xl border-b-4 border-yellow-800 w-full">
                    ğŸ§§ é–‹å§‹æ¯”è³½ ğŸ§§
                </button>
            </div>
        </div>

        <!-- é é¢ 3: éŠæˆ²è¨ˆæ™‚è¨ˆåˆ†é é¢ -->
        <div id="game-screen" class="hidden w-full h-full flex-col">
            <div class="text-center mb-2 flex-none">
                <h1 class="text-5xl font-black title-glow tracking-widest">ğŸï¸ æ–°æ˜¥å°è»Šç¥ ğŸï¸</h1>
            </div>
            
            <!-- è¨ˆæ™‚æ¬„ -->
            <div class="flex justify-between items-center bg-black/40 p-3 rounded-2xl border-2 border-yellow-900/50 mb-4 flex-none mx-4">
                <button onclick="resetGame()" class="bg-red-900 text-yellow-400 px-6 py-3 rounded-xl border-2 border-yellow-600 text-lg font-bold active:scale-90 transition-all">â¬…ï¸ çµæŸ</button>
                <div class="text-center flex flex-col justify-center">
                    <div id="timer" class="timer-display text-8xl font-black text-yellow-400 leading-none">60</div>
                    <p class="text-base font-bold text-yellow-200 tracking-widest -mt-1">å‰©é¤˜ç§’æ•¸</p>
                </div>
                <button onclick="resetScores()" class="bg-red-900 text-yellow-400 px-6 py-3 rounded-xl border-2 border-yellow-600 text-lg font-bold active:scale-90 transition-all">ğŸ”„ é‡ç½®</button>
            </div>

            <!-- è¨ˆåˆ†å€ (è‡ªå‹•å¡«æ»¿å‰©é¤˜é«˜åº¦) -->
            <div class="grid grid-cols-2 gap-6 px-4 pb-4 flex-1 min-h-0">
                <div class="score-card p-4 text-center shadow-2xl bg-red-950/40" onclick="addPoint(1)">
                    <div class="absolute top-4 left-4 bg-red-600 text-white px-3 py-1 rounded-full text-lg font-bold shadow-lg">PLAYER 1</div>
                    <h2 class="text-3xl font-bold mb-2 text-red-400 mt-2">ğŸ”´ ç´…è‰²å°è»Šç¥</h2>
                    <!-- ä½¿ç”¨ vw/vh å–®ä½ç¢ºä¿ä¸æº¢å‡º -->
                    <div id="score-1" class="text-[15vw] lg:text-[18vh] font-black leading-none text-white drop-shadow-[0_10px_20px_rgba(0,0,0,0.6)] flex-1 flex items-center justify-center">0</div>
                    <div class="mt-auto mb-2 inline-block bg-yellow-500 text-red-950 px-6 py-2 rounded-full font-black animate-pulse text-xl shadow-lg">é»æ“ŠåŠ åˆ†</div>
                </div>
                <div class="score-card p-4 text-center shadow-2xl bg-blue-950/40" onclick="addPoint(2)">
                    <div class="absolute top-4 right-4 bg-blue-600 text-white px-3 py-1 rounded-full text-lg font-bold shadow-lg">PLAYER 2</div>
                    <h2 class="text-3xl font-bold mb-2 text-blue-400 mt-2">ğŸ”µ è—è‰²å°è»Šç¥</h2>
                    <div id="score-2" class="text-[15vw] lg:text-[18vh] font-black leading-none text-white drop-shadow-[0_10px_20px_rgba(0,0,0,0.6)] flex-1 flex items-center justify-center">0</div>
                    <div class="mt-auto mb-2 inline-block bg-yellow-500 text-red-950 px-6 py-2 rounded-full font-black animate-pulse text-xl shadow-lg">é»æ“ŠåŠ åˆ†</div>
                </div>
            </div>
        </div>

        <!-- çµæŸå½ˆçª— -->
        <div id="overlay" class="fixed inset-0 bg-red-950/90 hidden items-center justify-center z-50 p-8 text-center backdrop-blur-xl">
            <div class="bg-red-800 border-[8px] border-yellow-500 p-8 rounded-[3rem] max-w-3xl w-full shadow-2xl">
                <div class="text-3xl mb-4 text-yellow-200">ğŸ è³½äº‹åœ“æ»¿çµæŸ ğŸ</div>
                <div id="winner-text" class="text-5xl font-black mb-8 text-white">ç©å®¶ç²å‹</div>
                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div class="bg-black/30 p-4 rounded-2xl border-4 border-red-500 text-white">
                        <p class="text-lg text-red-300">ç´…è‰²å¾—åˆ†</p>
                        <p id="final-1" class="text-5xl font-black">0</p>
                    </div>
                    <div class="bg-black/30 p-4 rounded-2xl border-4 border-blue-500 text-white">
                        <p class="text-lg text-blue-300">è—è‰²å¾—åˆ†</p>
                        <p id="final-2" class="text-5xl font-black">0</p>
                    </div>
                </div>
                
                <div class="flex gap-4">
                    <button onclick="startGame()" class="flex-1 bg-yellow-500 text-red-950 font-black py-5 rounded-2xl text-2xl shadow-xl active:scale-95 transition-transform">å†æˆ°ä¸€å±€</button>
                    <button onclick="resetGame()" class="flex-1 bg-red-900 text-yellow-500 font-black py-5 rounded-2xl text-xl border-4 border-yellow-600 active:scale-95 transition-transform">å›ä¸»é¸å–®</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let timeLeft = 0, timerId = null, bgmInterval = null;
        let scores = { 1: 0, 2: 0 }, isGameRunning = false;
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            g.gain.value = 0.0001;
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.01);
        }

        function playTone(freq, duration, type = 'sine', volume = 0.15) {
            if (!audioCtx) initAudio();
            if (audioCtx.state !== 'running') return;
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        function startBgm() {
            if (bgmInterval) clearInterval(bgmInterval);
            const playNote = () => {
                if (!isGameRunning) return;
                const melody = [261.63, 329.63, 392.00, 329.63];
                let i = 0;
                const beat = setInterval(() => {
                    if (!isGameRunning || i >= melody.length) { clearInterval(beat); return; }
                    playTone(melody[i], 0.25, 'triangle', 0.08);
                    i++;
                }, 250);
            };
            playNote();
            bgmInterval = setInterval(playNote, 1000);
        }

        function stopBgm() { 
            clearInterval(bgmInterval); 
            bgmInterval = null;
        }

        function hideAllScreens() {
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('intro-screen').classList.remove('flex'); // ç§»é™¤ flex ä»¥éš±è—
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('flex'); // ç§»é™¤ flex
            const overlay = document.getElementById('overlay');
            overlay.classList.add('hidden');
            overlay.classList.remove('flex');
        }

        function showSetup() {
            initAudio();
            hideAllScreens();
            document.getElementById('setup-screen').classList.remove('hidden');
            playTone(523.25, 0.1);
        }

        function resetGame() {
            initAudio();
            isGameRunning = false;
            clearInterval(timerId);
            stopBgm();
            hideAllScreens();
            const intro = document.getElementById('intro-screen');
            intro.classList.remove('hidden');
            intro.classList.add('flex'); // æ¢å¾© flex ä½ˆå±€
            playTone(329.63, 0.2);
        }

        function adjustTime(val) {
            initAudio();
            const input = document.getElementById('time-input');
            input.value = Math.max(10, parseInt(input.value) + val);
            playTone(440, 0.05);
        }

        function startGame() {
            initAudio();
            timeLeft = parseInt(document.getElementById('time-input').value) || 60;
            document.getElementById('timer').innerText = timeLeft;
            
            scores = { 1: 0, 2: 0 };
            isGameRunning = true;
            updateScoreDisplay();
            hideAllScreens();
            const gameScreen = document.getElementById('game-screen');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex'); // ä½¿ç”¨ flex ä½ˆå±€
            
            startBgm();
            startTimer();
            playTone(523.25, 0.1);
            setTimeout(() => playTone(659.25, 0.1), 150);
            setTimeout(() => playTone(783.99, 0.3), 300);
        }

        function startTimer() {
            if (timerId) clearInterval(timerId);
            timerId = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                if (timeLeft <= 5 && timeLeft > 0) {
                    playTone(880, 0.1, 'square', 0.08);
                }
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function addPoint(p) {
            if (!isGameRunning) return;
            scores[p]++;
            updateScoreDisplay();
            playTone(p === 1 ? 523.25 : 783.99, 0.15, 'sine', 0.2);
        }

        function updateScoreDisplay() {
            document.getElementById('score-1').innerText = scores[1];
            document.getElementById('score-2').innerText = scores[2];
        }

        function endGame() {
            isGameRunning = false;
            clearInterval(timerId); 
            stopBgm();
            playTone(1046.5, 0.5, 'square', 0.1); 
            document.getElementById('final-1').innerText = scores[1];
            document.getElementById('final-2').innerText = scores[2];
            document.getElementById('winner-text').innerText = scores[1] > scores[2] ? "ğŸ”´ ç´…è‰²å°è»Šç¥é ˜å…ˆï¼" : (scores[1] < scores[2] ? "ğŸ”µ è—è‰²å°è»Šç¥é ˜å…ˆï¼" : "æ¡æ‰‹è¨€å’Œï¼Œæ–°å¹´å¿«æ¨‚ï¼");
            
            const overlay = document.getElementById('overlay');
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
        }

        function resetScores() { 
            scores = { 1: 0, 2: 0 }; 
            updateScoreDisplay(); 
            playTone(440, 0.1); 
        }

        window.onload = initAudio;
    </script>
</body>
</html>